{# templates/kp/customer_request.html #}
{% extends "base.html" %}
{% load i18n %}
{% block title %}{% trans "Заявка на КП" %}{% endblock %}

{% block content %}
  <div class="card">
    <div class="kp-builder-title" style="font-weight:900;">{% trans "Заявка отправлена менеджеру" %}</div>
    <div class="muted" style="margin-top:6px;">
      {% trans "Менеджер увидит заявку в своём списке КП и свяжется с тобой." %}
    </div>

    <div style="margin-top:12px;">
      <div class="muted" style="font-size:12px;">{% trans "Номер заявки" %}</div>
      <div style="font-weight:900; font-size:18px;">#{{ kp.id }}</div>
    </div>

    <div style="margin-top:12px;">
      <div class="muted" style="font-size:12px;">{% trans "Итоговая сумма" %}</div>
      <div style="font-weight:900; font-size:22px;">{{ total_sum }} ₸</div>
    </div>

    <div class="card" style="margin-top:12px;">
      <div style="font-weight:900;">{% trans "Контакты, которые уйдут менеджеру" %}</div>
      <div class="muted" style="margin-top:6px; font-size:12px;">
        {% trans "Email:" %} <b>{{ contact.email|default:"—" }}</b><br>
        {% trans "Телефон:" %} <b>{{ contact.phone|default:"—" }}</b><br>
        {% trans "Telegram:" %} <b>{{ contact.telegram|default:"—" }}</b>
      </div>
      <div class="muted" style="margin-top:8px; font-size:12px;">
        {% trans "(Поля phone/telegram появятся, когда ты добавишь их в модель пользователя.)" %}
      </div>
    </div>

    <div class="muted" style="margin-top:12px; font-size:12px;">
      {% trans "Дальше будет “чат с ботом” и “добавление в телеграм”. Сейчас это просто заглушка, чтобы процесс работал." %}
    </div>

    <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
      <a class="btn" href="{% url 'main:home' %}">{% trans "Вернуться в категории" %}</a>
      <a class="btn btn-compact" href="{% url 'kp:kp' %}">{% trans "Моё КП" %}</a>
    </div>
  </div>

  <div style="margin-top:12px;">
    {% for it in items %}
      <div class="card" style="display:flex; gap:12px; align-items:center; margin-bottom:10px;">
        <div style="width:72px; height:54px; border-radius:12px; overflow:hidden; border:1px solid var(--border); background:#eef0f6;">
          {% if it.service.image %}
            <img src="{{ it.service.image.url }}" alt="{{ it.service.name }}"
                 style="width:100%; height:100%; object-fit:cover;">
          {% endif %}
        </div>

        <div style="flex:1; min-width:0;">
          <div style="font-weight:800; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">
            {{ it.service.name }}
          </div>
          <div class="muted" style="font-size:12px;">
            {% blocktrans with qty=it.qty price=it.price %}{{ qty }} шт · {{ price }} ₸{% endblocktrans %}
          </div>
        </div>

        <div style="text-align:right;">
          <div style="font-weight:900;">{{ it.total_price }} ₸</div>
        </div>
      </div>
    {% endfor %}
  </div>
{% endblock %}
