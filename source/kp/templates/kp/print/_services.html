{% load static %}
{% load i18n %}

<section class="block">
  <h2 class="h2 center">{% trans "Услуги" %}</h2>
  <div class="muted center svc-subtitle">{% trans "Состав и стоимость" %}</div>

  {% if items %}
    <div class="services-grid">
      {% for it in items %}
        <article class="svc-card">
          <div class="svc-photo">
            {% if it.service.image %}
              <img
                class="svc-photo-img"
                src="{% if site_url %}{{ site_url }}{% else %}{% static 'default-image.jpg' %}{% endif %}{{ it.service.image.url }}"
                alt="{{ it.service.name|default:_('Услуга') }}"
                loading="lazy"
              >
            {% else %}
              <div class="svc-no-photo muted">{% trans "Без фото" %}</div>
            {% endif %}
          </div>

          <div class="svc-title center">
            {{ it.service.name|default:_("Услуга") }}
          </div>

          {% if it.service.description %}
            <div class="svc-desc">{{ it.service.description }}</div>
          {% else %}
            <div class="svc-desc muted">{% trans "Описание не указано." %}</div>
          {% endif %}

          <div class="svc-meta">
            <div class="svc-row">
              <span class="muted">{% trans "Количество" %}</span>
              <span class="meta-strong">{{ it.qty|default:"—" }}</span>
            </div>

            <div class="svc-row">
              <span class="muted">{% trans "Цена" %}</span>
              <span class="meta-strong">
                {{ it.price|default:"0" }} ₸
              </span>
            </div>

            {% if it.discount and it.discount > 0 %}
              <div class="svc-row">
                <span class="muted">{% trans "Скидка" %}</span>
                <span class="meta-strong">{{ it.discount }}</span>
              </div>
            {% endif %}

            <div class="svc-row svc-row-total">
              <span class="muted">{% trans "Сумма" %}</span>
              <span class="meta-strong">
                {% if it.line_total %}
                  {{ it.line_total }} ₸
                {% else %}
                  {{ it.total_price }} ₸
                {% endif %}
              </span>
            </div>
          </div>
        </article>
      {% endfor %}
    </div>

    <div class="total-box total-invoice">
      <div class="total-row">
        <span class="muted">{% trans "Сумма услуг" %}</span>
        <b>{{ subtotal }} ₸</b>
      </div>
    
      <div class="total-row">
        <span class="muted">{% trans "Комиссия агенства 20%" %}</span>
        <b>+ {{ extra20 }} ₸</b>
      </div>
    
      <div class="total-row total-final">
        <span>{% trans "ИТОГО" %}</span>
        <span>{{ total }} ₸</span>
      </div>
    </div>    
  {% else %}
    <div class="field">
      <div class="value muted">{% trans "Услуги не добавлены." %}</div>
    </div>
  {% endif %}
</section>
