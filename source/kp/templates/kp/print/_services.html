{% load static %}

<section class="block">
  <h2 class="h2 center">Услуги</h2>
  <div class="muted center svc-subtitle">Состав и стоимость</div>

  {% if items %}
    <div class="services-grid">
      {% for it in items %}
        <article class="svc-card">
          <div class="svc-photo">
            {% if it.service.image %}
              <img
                class="svc-photo-img"
                src="{% if site_url %}{{ site_url }}{% else %}{% static 'default-image.jpg' %}{% endif %}{{ it.service.image.url }}"
                alt="{{ it.service.name|default:'Услуга' }}"
                loading="lazy"
              >
            {% else %}
              <div class="svc-no-photo muted">Без фото</div>
            {% endif %}
          </div>

          <div class="svc-title center">
            {{ it.service.name|default:"Услуга" }}
          </div>

          {% if it.service.description %}
            <div class="svc-desc">{{ it.service.description }}</div>
          {% else %}
            <div class="svc-desc muted">Описание не указано.</div>
          {% endif %}

          <div class="svc-meta">
            <div class="svc-row">
              <span class="muted">Количество</span>
              <span class="meta-strong">{{ it.qty|default:"—" }}</span>
            </div>

            <div class="svc-row">
              <span class="muted">Цена</span>
              <span class="meta-strong">
                {{ it.price|default:"0" }} ₸
              </span>
            </div>

            {% if it.discount and it.discount > 0 %}
              <div class="svc-row">
                <span class="muted">Скидка</span>
                <span class="meta-strong">{{ it.discount }}</span>
              </div>
            {% endif %}

            <div class="svc-row svc-row-total">
              <span class="muted">Сумма</span>
              <span class="meta-strong">
                {% if it.line_total %}
                  {{ it.line_total }} ₸
                {% else %}
                  {{ it.total_price }} ₸
                {% endif %}
              </span>
            </div>
          </div>
        </article>
      {% endfor %}
    </div>

    <div class="total-box total-invoice">
      <div class="total-row">
        <span class="muted">Сумма услуг</span>
        <b>{{ subtotal }} ₸</b>
      </div>
    
      <div class="total-row">
        <span class="muted">Комиссия агенства 20%</span>
        <b>+ {{ extra20 }} ₸</b>
      </div>
    
      <div class="total-row total-final">
        <span>ИТОГО</span>
        <span>{{ total }} ₸</span>
      </div>
    </div>    
  {% else %}
    <div class="field">
      <div class="value muted">Услуги не добавлены.</div>
    </div>
  {% endif %}
</section>
